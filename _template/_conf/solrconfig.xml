<?xml version="1.0" encoding="UTF-8" ?>

<config xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="common/luceneMatchVersion.xml" />
  <xi:include href="common/sharedCacheHandler.xml" />
  <xi:include href="common/directoryFactory.xml" />
  <xi:include href="common/dataDir.xml" />
  <xi:include href="common/schemaFactory.xml" />
  <xi:include href="common/queryCache.xml" />
  <updateHandler class="solr.DirectUpdateHandler2">
    <updateLog>
      <str name="dir">${solr.solr.home}/data/${solr.core.name:}</str>
    </updateLog>
    <!-- https://cwiki.apache.org/confluence/display/solr/Near+Real+Time+Searching -->
    <xi:include href="common/autoCommit.xml" />
    <xi:include href="common/autoSoftCommit.xml" />
  </updateHandler>
  <initParams path="/select,/advanced,/basic" >
    <lst name="defaults">
      <str name="echoParams">explicit</str>
      <str name="fl">score,_store</str>
      <str name="qf">${entity.qf:}</str>
      <!-- creates a minimum match threshold of 2 from the above fields; dropping this to 1 allows
        a ridiculous amount of false matches from the ngram field (basically if an ngram is a
        match, another field needs a match as well to be in the results); this doesn't seem to
        affect exact matches in the ipi, isni or mbid fields (they are still matches even being
        found in a single field)-->
      <str name="mm">${entity.mm:1}</str>
      <!-- boost searches containing phrase matches in these fields -->
      <str name="pf">${entity.pf:}</str>
      <!-- boosts results for artists with more releases -->
      <str name="bf">${entity.bf:}</str>
      <str name="bq">${entity.bq:}</str>
      <str name="ps">${entity.ps:1}</str>
    </lst>
  </initParams>
  <xi:include href="common/requestHandler-select.xml" />
  <xi:include href="common/requestHandler-advanced.xml" />
  <xi:include href="common/requestHandler-basic.xml" />
  <xi:include href="common/requestHandler-get.xml" />
  <xi:include href="common/requestHandler-replication.xml" />
  <xi:include href="common/requestDispatcher.xml" />
  <xi:include href="common/requestHandler-standard.xml" />
  <xi:include href="common/requestHandler-field.xml" />
  <xi:include href="common/requestHandler-update.xml" />
  <xi:include href="common/requestHandler-ping.xml" />
  <!-- config for the admin interface -->
  <xi:include href="common/admin.xml" />

  <queryResponseWriter name="mbxml" class="org.musicbrainz.search.solrwriter.MBXMLWriter">
      <str name="entitytype">${entity.type:}</str>
  </queryResponseWriter>
  <queryResponseWriter name="mbjson" class="org.musicbrainz.search.solrwriter.MBJSONWriter">
      <str name="entitytype">${entity.type:}</str>
  </queryResponseWriter>
</config>
